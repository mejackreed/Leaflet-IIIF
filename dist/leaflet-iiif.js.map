{"version":3,"file":"leaflet-iiif.js","sources":["../src/leaflet-iiif.js"],"sourcesContent":["/*\n * Leaflet-IIIF 3.1.0-alpha.1\n * IIIF Viewer for Leaflet\n * by Jack Reed, @mejackreed\n */\n\nimport L from 'leaflet/dist/leaflet-src.esm';\n\nL.TileLayer.Iiif = L.TileLayer.extend({\n  options: {\n    continuousWorld: true,\n    tileSize: 256,\n    updateWhenIdle: true,\n    tileFormat: 'jpg',\n    fitBounds: true,\n    setMaxBounds: false\n  },\n\n  initialize: function(url, options) {\n    options = typeof options !== 'undefined' ? options : {};\n\n    if (options.maxZoom) {\n      this._customMaxZoom = true;\n    }\n\n    // Check for explicit tileSize set\n    if (options.tileSize) {\n      this._explicitTileSize = true;\n    }\n\n    // Check for an explicit quality\n    if (options.quality) {\n      this._explicitQuality = true;\n    }\n\n    options = L.setOptions(this, options);\n    this._infoPromise = null;\n    this._infoUrl = url;\n    this._baseUrl = this._templateUrl();\n    this._getInfo();\n  },\n  getTileUrl: function(coords) {\n    var _this = this,\n      x = coords.x,\n      y = (coords.y),\n      zoom = _this._getZoomForUrl(),\n      scale = Math.pow(2, _this.maxNativeZoom - zoom),\n      tileBaseSize = _this.options.tileSize * scale,\n      minx = (x * tileBaseSize),\n      miny = (y * tileBaseSize),\n      maxx = Math.min(minx + tileBaseSize, _this.x),\n      maxy = Math.min(miny + tileBaseSize, _this.y);\n    \n    var xDiff = (maxx - minx);\n    var yDiff = (maxy - miny);\n\n    // Canonical URI Syntax for v2\n    var size = Math.ceil(xDiff / scale) + ',';\n    if (_this.type === 'ImageService3') {\n      // Cannonical URI Syntax for v3\n      size = size + Math.ceil(yDiff / scale);\n    }\n\n    return L.Util.template(this._baseUrl, L.extend({\n      format: _this.options.tileFormat,\n      quality: _this.quality,\n      region: [minx, miny, xDiff, yDiff].join(','),\n      rotation: 0,\n      size: size\n    }, this.options));\n  },\n  onAdd: function(map) {\n    var _this = this;\n\n    // Wait for info.json fetch and parse to complete\n    Promise.all([_this._infoPromise]).then(function() {\n      // Store unmutated imageSizes\n      _this._imageSizesOriginal = _this._imageSizes.slice(0); \n\n      // Set maxZoom for map\n      map._layersMaxZoom = _this.maxZoom;\n\n      // Call add TileLayer\n      L.TileLayer.prototype.onAdd.call(_this, map);\n\n      // Set minZoom and minNativeZoom based on how the imageSizes match up\n      var smallestImage = _this._imageSizes[0];\n      var mapSize = _this._map.getSize();\n      var newMinZoom = 0;\n      // Loop back through 5 times to see if a better fit can be found.\n      for (var i = 1; i <= 5; i++) {\n        if (smallestImage.x > mapSize.x || smallestImage.y > mapSize.y) {\n          smallestImage = smallestImage.divideBy(2);\n          _this._imageSizes.unshift(smallestImage);\n          newMinZoom = -i;\n        } else {\n          break;\n        }\n      }\n      _this.options.minZoom = newMinZoom;\n      _this.options.minNativeZoom = newMinZoom;\n      _this._prev_map_layersMinZoom = _this._map._layersMinZoom;\n      _this._map._layersMinZoom = newMinZoom;\n\n      if (_this.options.fitBounds) {\n        _this._fitBounds();\n      }\n\n      if(_this.options.setMaxBounds) {\n        _this._setMaxBounds();\n      }\n\n      // Reset tile sizes to handle non 256x256 IIIF tiles\n      _this.on('tileload', function(tile, url) {\n\n        var height = tile.tile.naturalHeight,\n          width = tile.tile.naturalWidth;\n\n        // No need to resize if tile is 256 x 256\n        if (height === 256 && width === 256) return;\n\n        tile.tile.style.width = width + 'px';\n        tile.tile.style.height = height + 'px';\n\n      });\n    })\n    .catch(function(err){\n        console.error(err);\n    });\n  },\n  onRemove: function(map) {\n    var _this = this;\n    \n    map._layersMinZoom = _this._prev_map_layersMinZoom;\n    _this._imageSizes = _this._imageSizesOriginal;\n\n    // Remove maxBounds set for this image\n    if(_this.options.setMaxBounds) {\n      map.setMaxBounds(null);\n    }\n\n    // Call remove TileLayer\n    L.TileLayer.prototype.onRemove.call(_this, map);\n\n  },\n  _fitBounds: function() {\n    var _this = this;\n\n    // Find best zoom level and center map\n    var initialZoom = _this._getInitialZoom(_this._map.getSize());\n    var offset = _this._imageSizes.length - 1 - _this.options.maxNativeZoom;\n    var imageSize = _this._imageSizes[initialZoom + offset];\n    var sw = _this._map.options.crs.pointToLatLng(L.point(0, imageSize.y), initialZoom);\n    var ne = _this._map.options.crs.pointToLatLng(L.point(imageSize.x, 0), initialZoom);\n    var bounds = L.latLngBounds(sw, ne);\n\n    _this._map.fitBounds(bounds, true);\n  },\n  _setMaxBounds: function() {\n    var _this = this;\n\n    // Find best zoom level, center map, and constrain viewer\n    var initialZoom = _this._getInitialZoom(_this._map.getSize());\n    var imageSize = _this._imageSizes[initialZoom];\n    var sw = _this._map.options.crs.pointToLatLng(L.point(0, imageSize.y), initialZoom);\n    var ne = _this._map.options.crs.pointToLatLng(L.point(imageSize.x, 0), initialZoom);\n    var bounds = L.latLngBounds(sw, ne);\n\n    _this._map.setMaxBounds(bounds, true);\n  },\n  _getInfo: function() {\n    var _this = this;\n\n    _this._infoPromise = fetch(_this._infoUrl)\n      .then(function(response) {\n        return response.json();\n      })\n      .catch(function(err){\n          console.error(err);\n      })\n      .then(function(data) {\n        _this.y = data.height;\n        _this.x = data.width;\n\n        var tierSizes = [],\n          imageSizes = [],\n          scale,\n          width_,\n          height_,\n          tilesX_,\n          tilesY_;\n\n        // Set quality based off of IIIF version\n        if (data.profile instanceof Array) {\n          _this.profile = data.profile[0];\n        }else {\n          _this.profile = data.profile;\n        }\n        _this.type = data.type;\n\n        _this._setQuality();\n\n        // Unless an explicit tileSize is set, use a preferred tileSize\n        if (!_this._explicitTileSize) {\n          // Set the default first\n          _this.options.tileSize = 256;\n          if (data.tiles) {\n            // Image API 2.0 Case\n            _this.options.tileSize = data.tiles[0].width;\n          } else if (data.tile_width){\n            // Image API 1.1 Case\n            _this.options.tileSize = data.tile_width;\n          }\n        }\n\n        function ceilLog2(x) {\n          return Math.ceil(Math.log(x) / Math.LN2);\n        };\n\n        // Calculates maximum native zoom for the layer\n        _this.maxNativeZoom = Math.max(\n          ceilLog2(_this.x / _this.options.tileSize),\n          ceilLog2(_this.y / _this.options.tileSize),\n          0\n        );\n        _this.options.maxNativeZoom = _this.maxNativeZoom;\n        \n        // Enable zooming further than native if maxZoom option supplied\n        if (_this._customMaxZoom && _this.options.maxZoom > _this.maxNativeZoom) {\n          _this.maxZoom = _this.options.maxZoom;\n        }\n        else {\n          _this.maxZoom = _this.maxNativeZoom;\n        }\n        \n        for (var i = 0; i <= _this.maxZoom; i++) {\n          scale = Math.pow(2, _this.maxNativeZoom - i);\n          width_ = Math.ceil(_this.x / scale);\n          height_ = Math.ceil(_this.y / scale);\n          tilesX_ = Math.ceil(width_ / _this.options.tileSize);\n          tilesY_ = Math.ceil(height_ / _this.options.tileSize);\n          tierSizes.push([tilesX_, tilesY_]);\n          imageSizes.push(L.point(width_,height_));\n        }\n\n        _this._tierSizes = tierSizes;\n        _this._imageSizes = imageSizes;\n      })\n      .catch(function(err){\n          console.error(err);\n      });\n      \n  },\n\n  _setQuality: function() {\n    var _this = this;\n    var profileToCheck = _this.profile;\n\n    if (_this._explicitQuality) {\n      return;\n    }\n\n    // If profile is an object\n    if (typeof(profileToCheck) === 'object') {\n      profileToCheck = profileToCheck['@id'];\n    }\n\n    // Set the quality based on the IIIF compliance level\n    switch (true) {\n      case /^http:\\/\\/library.stanford.edu\\/iiif\\/image-api\\/1.1\\/compliance.html.*$/.test(profileToCheck):\n        _this.options.quality = 'native';\n        break;\n      // Assume later profiles and set to default\n      default:\n        _this.options.quality = 'default';\n        break;\n    }\n  },\n\n  _infoToBaseUrl: function() {\n    return this._infoUrl.replace('info.json', '');\n  },\n  _templateUrl: function() {\n    return this._infoToBaseUrl() + '{region}/{size}/{rotation}/{quality}.{format}';\n  },\n  _isValidTile: function(coords) {\n    var _this = this;\n    var zoom = _this._getZoomForUrl();\n    var sizes = _this._tierSizes[zoom];\n    var x = coords.x;\n    var y = coords.y;\n    if (zoom < 0 && x >= 0 && y >= 0) {\n      return true;\n    }\n\n    if (!sizes) return false;\n    if (x < 0 || sizes[0] <= x || y < 0 || sizes[1] <= y) {\n      return false;\n    }else {\n      return true;\n    }\n  },\n  _tileShouldBeLoaded: function(coords) {\n    return this._isValidTile(coords);\n  },\n  _getInitialZoom: function (mapSize) {\n    var _this = this;\n    var tolerance = 0.8;\n    var imageSize;\n    // Calculate an offset between the zoom levels and the array accessors\n    var offset = _this._imageSizes.length - 1 - _this.options.maxNativeZoom;\n    for (var i = _this._imageSizes.length - 1; i >= 0; i--) {\n      imageSize = _this._imageSizes[i];\n      if (imageSize.x * tolerance < mapSize.x && imageSize.y * tolerance < mapSize.y) {\n        return i - offset;\n      }\n    }\n    // return a default zoom\n    return 2;\n  }\n});\n\nL.tileLayer.iiif = function(url, options) {\n  return new L.TileLayer.Iiif(url, options);\n};\n"],"names":[],"mappings":"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"}